[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "YUMM –&gt; cold tumor YUMMER –&gt; hot tumor/very active immune response"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "LECs_tumor",
    "section": "",
    "text": "Study LEC migration within lymphatic system in the context of “hot” and “cold” tumor"
  },
  {
    "objectID": "code/SNF_draft/YUMM_vs_YUMMER/vis_de.html",
    "href": "code/SNF_draft/YUMM_vs_YUMMER/vis_de.html",
    "title": "vis_de",
    "section": "",
    "text": "Different visualization of the results from clusterwise DE analysis between merged LECs in all YUMM and YUMMER sample. DE was performed as part of a preliminary analysis of BD RHapsody sequencing data conducted by the FCGZ.\n\n\n\nPreliminary analysis identified 7 cluster. That is probably to many. We would expect 3-5 different LEC subpopulations. Ultimately we will probably recluster or merge cluster based on marker gene expression before DE analysis is conducted.\nThere are 2 result gene lists:\n\nConserved marker: Cluster marker genes (DE compared to other cluster) conserved across conditions. Cluster marker that are independent of the tumor type. These can be used to characterize/annotate cluster within the merged/integrated dataset.\nDE genes: Differentially expressed genes between conditions (YUMM vs YUMMER) within each cluster (“Celltype-specific changes”).\n\nMeaning in output table:\n\ncondition_pct.1: percentage of cells where the gene is detected in the cluster for condition\ncondition_pct.2: percentage of cells where the gene is detected on average in the other clusters for condition\n\n\n\n\n\n\nDo we expect specific LEC subtypes to change more between tumor types or do we expect more global changes across all LECs? It could be worth running a DE analysis for all LECs between the tumor types if the later is the case.\nDifferential abundance analysis: Do we expect a gloabl shift in LEC abundance or a subtype-specific shift?\n\n\n\n\n\nlibrary(edgeR)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(pheatmap)\nlibrary(patchwork)\nlibrary(Seurat)\nlibrary(readxl)\nlibrary(ggbeeswarm)\nlibrary(EnhancedVolcano)\nlibrary(SingleCellExperiment)\nlibrary(gridExtra)\n\n\n\n\nseurat &lt;- readRDS(file.path(\"..\", \"..\", \"..\", \"data\", \"scData.rds\"))\nDefaultAssay(seurat) &lt;- \"SCT\"\nde_genes &lt;- read_excel(file.path(\"..\", \"..\", \"..\", \"data\", \"diffGenes_yumm_yummer.xlsx\"))\n\n\n\n\n\n\nCode\n# volcano plot function as defined in https://github.com/HelenaLC/TLS-Silina/blob/main/code/geo-02-differential.qmd\n\n.volcano &lt;- \\(df, title, fdr = 0.05, lfc = 1) {\n  EnhancedVolcano(df, \n    x = \"avg_log2FC\", y = \"p_val_adj\",\n    FCcutoff = lfc, pCutoff = fdr,\n    pointSize = 1.7, raster = TRUE,\n    title = title, subtitle = NULL,\n    lab = df[[\"gene\"]], labSize = 4, \n    drawConnectors = TRUE, widthConnectors = 0.5) +\n  guides(col = guide_legend(override.aes = list(alpha = 1, size = 5))) +\n  theme_bw(9) + theme(\n    aspect.ratio = 1,\n    legend.title = element_blank(),\n    panel.grid.minor = element_blank())\n}\n\n.heatmap &lt;- \\(mtx, de_genes, cd, title, fdr = 0.05, n_lfc = 20) {\n  top &lt;- de_genes %&gt;%\n    filter(p_val_adj &lt; fdr) |&gt; \n    slice_max(abs(avg_log2FC), n = n_lfc)\n  mtx_sub &lt;- log1p(mtx[top$gene,])\n  if (length(top$gene) &lt; 2){\n    return(print(\"No de genes\"))\n  }else{\n  hm &lt;- pheatmap(mtx_sub, \n      main = title, fontsize = 6,\n      col = rev(hcl.colors(51, \"RdBu\")),\n      scale = \"row\", show_colnames = FALSE, annotation_col = cd)\n  hm\n  }\n}\n\n\n.feature_c &lt;- \\(seu, c, fdr = 0.05, n_lfc = 5) {\n  top &lt;- de_genes %&gt;%\n    filter(cluster %in% c) |&gt; \n    filter(p_val_adj &lt; fdr) |&gt; \n    slice_max(abs(avg_log2FC), n = n_lfc)\n  if (length(top$gene) &lt; 2){\n    return(print(\"No de genes\"))\n  }else{\n  p &lt;- FeaturePlot(seurat, features = top$gene, split.by = 'Condition',\n              max.cutoff = 3, cols = c('grey', 'red'))\n  p\n  }\n}\n\n.violin_c &lt;- \\(seu, c, fdr = 0.05, n_lfc = 5) {\n  top &lt;- de_genes %&gt;%\n    filter(cluster %in% c) |&gt; \n    filter(p_val_adj &lt; fdr) |&gt; \n    slice_max(abs(avg_log2FC), n = n_lfc)\n  if (length(top$gene) &lt; 2){\n    return(print(\"No de genes\"))\n  }else{\n  p &lt;- VlnPlot(seurat, features = top$gene, split.by = 'Condition',\n              group.by = \"ident\", pt.size = 0, combine = FALSE)\n  wrap_plots(plots = p, ncol = 1)\n  }\n}\n\n\n\n\n\n\nTo get an overview of the distribution of cluster in 2d.\n\nDimPlot(seurat, label = TRUE)\n\n\n\n\n\n\nPlot most differentially expressed genes as volcano plot. We don’t have stats for all, but only DE genes (yet). This explains the shape of the volcano.\n\n\nCode\ncluster &lt;- levels(as.factor(de_genes$cluster))\n\n\n\n01234567\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\nWarning: ggrepel: 18 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\n\n\nShow the expression of the top cluster-specific DE genes on the UMAP plot\n\n01234567\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\n\n\nThe same as above, but as violin plot to better see expression level\n\n01234567\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\nThe default behaviour of split.by has changed.\nSeparate violin plots are now plotted side-by-side.\nTo restore the old behaviour of a single split violin,\nset split.plot = TRUE.\n      \nThis message will be shown once per session.\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\n\n\n\n\nCode\npurrr::map(cluster, \\(c) {\n      de_c &lt;- de_genes |&gt; \n        filter(cluster %in% c)\n      sub &lt;- subset(x = seurat, idents = c)\n      mtx &lt;- GetAssayData(object = sub, slot = 'data')\n      cd &lt;- data.frame(sub[[]] |&gt; select('Condition'))\n      .heatmap(mtx, de_c, cd, title = paste0('DE YUMM vs YUMMER in ', c),\n        fdr = 0.1, n_lfc = 20)\n})\n\n\n\n\n\n\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\n\n\n\n\n\n[1] \"No de genes\"\n\n\n\n\n\n[[1]]\n\n[[2]]\n\n[[3]]\n[1] \"No de genes\"\n\n[[4]]\n\n[[5]]\n\n[[6]]\n\n[[7]]\n\n[[8]]\n[1] \"No de genes\""
  },
  {
    "objectID": "code/SNF_draft/YUMM_vs_YUMMER/vis_de.html#preamble",
    "href": "code/SNF_draft/YUMM_vs_YUMMER/vis_de.html#preamble",
    "title": "vis_de",
    "section": "",
    "text": "library(edgeR)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scuttle)\nlibrary(pheatmap)\nlibrary(patchwork)\nlibrary(Seurat)\nlibrary(readxl)\nlibrary(ggbeeswarm)\nlibrary(EnhancedVolcano)\nlibrary(SingleCellExperiment)\nlibrary(gridExtra)\n\n\n\n\nseurat &lt;- readRDS(file.path(\"..\", \"..\", \"..\", \"data\", \"scData.rds\"))\nDefaultAssay(seurat) &lt;- \"SCT\"\nde_genes &lt;- read_excel(file.path(\"..\", \"..\", \"..\", \"data\", \"diffGenes_yumm_yummer.xlsx\"))\n\n\n\n\n\n\nCode\n# volcano plot function as defined in https://github.com/HelenaLC/TLS-Silina/blob/main/code/geo-02-differential.qmd\n\n.volcano &lt;- \\(df, title, fdr = 0.05, lfc = 1) {\n  EnhancedVolcano(df, \n    x = \"avg_log2FC\", y = \"p_val_adj\",\n    FCcutoff = lfc, pCutoff = fdr,\n    pointSize = 1.7, raster = TRUE,\n    title = title, subtitle = NULL,\n    lab = df[[\"gene\"]], labSize = 4, \n    drawConnectors = TRUE, widthConnectors = 0.5) +\n  guides(col = guide_legend(override.aes = list(alpha = 1, size = 5))) +\n  theme_bw(9) + theme(\n    aspect.ratio = 1,\n    legend.title = element_blank(),\n    panel.grid.minor = element_blank())\n}\n\n.heatmap &lt;- \\(mtx, de_genes, cd, title, fdr = 0.05, n_lfc = 20) {\n  top &lt;- de_genes %&gt;%\n    filter(p_val_adj &lt; fdr) |&gt; \n    slice_max(abs(avg_log2FC), n = n_lfc)\n  mtx_sub &lt;- log1p(mtx[top$gene,])\n  if (length(top$gene) &lt; 2){\n    return(print(\"No de genes\"))\n  }else{\n  hm &lt;- pheatmap(mtx_sub, \n      main = title, fontsize = 6,\n      col = rev(hcl.colors(51, \"RdBu\")),\n      scale = \"row\", show_colnames = FALSE, annotation_col = cd)\n  hm\n  }\n}\n\n\n.feature_c &lt;- \\(seu, c, fdr = 0.05, n_lfc = 5) {\n  top &lt;- de_genes %&gt;%\n    filter(cluster %in% c) |&gt; \n    filter(p_val_adj &lt; fdr) |&gt; \n    slice_max(abs(avg_log2FC), n = n_lfc)\n  if (length(top$gene) &lt; 2){\n    return(print(\"No de genes\"))\n  }else{\n  p &lt;- FeaturePlot(seurat, features = top$gene, split.by = 'Condition',\n              max.cutoff = 3, cols = c('grey', 'red'))\n  p\n  }\n}\n\n.violin_c &lt;- \\(seu, c, fdr = 0.05, n_lfc = 5) {\n  top &lt;- de_genes %&gt;%\n    filter(cluster %in% c) |&gt; \n    filter(p_val_adj &lt; fdr) |&gt; \n    slice_max(abs(avg_log2FC), n = n_lfc)\n  if (length(top$gene) &lt; 2){\n    return(print(\"No de genes\"))\n  }else{\n  p &lt;- VlnPlot(seurat, features = top$gene, split.by = 'Condition',\n              group.by = \"ident\", pt.size = 0, combine = FALSE)\n  wrap_plots(plots = p, ncol = 1)\n  }\n}"
  },
  {
    "objectID": "code/SNF_draft/YUMM_vs_YUMMER/vis_de.html#visualization",
    "href": "code/SNF_draft/YUMM_vs_YUMMER/vis_de.html#visualization",
    "title": "vis_de",
    "section": "",
    "text": "To get an overview of the distribution of cluster in 2d.\n\nDimPlot(seurat, label = TRUE)\n\n\n\n\n\n\nPlot most differentially expressed genes as volcano plot. We don’t have stats for all, but only DE genes (yet). This explains the shape of the volcano.\n\n\nCode\ncluster &lt;- levels(as.factor(de_genes$cluster))\n\n\n\n01234567\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\nWarning: ggrepel: 18 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\nCode\ndf &lt;- filter(de_genes, cluster == c)\n.volcano(df, title = c, fdr = 0.1, lfc = 0.5) +\n  theme(legend.position = 'top')\n\n\n\n\n\n\n\n\n\n\n\nShow the expression of the top cluster-specific DE genes on the UMAP plot\n\n01234567\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.feature_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\n\n\nThe same as above, but as violin plot to better see expression level\n\n01234567\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\nThe default behaviour of split.by has changed.\nSeparate violin plots are now plotted side-by-side.\nTo restore the old behaviour of a single split violin,\nset split.plot = TRUE.\n      \nThis message will be shown once per session.\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n\n\n\n\n\n\n\nCode\n.violin_c(seu = seurat, c=c)\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\n\n\n\n\nCode\npurrr::map(cluster, \\(c) {\n      de_c &lt;- de_genes |&gt; \n        filter(cluster %in% c)\n      sub &lt;- subset(x = seurat, idents = c)\n      mtx &lt;- GetAssayData(object = sub, slot = 'data')\n      cd &lt;- data.frame(sub[[]] |&gt; select('Condition'))\n      .heatmap(mtx, de_c, cd, title = paste0('DE YUMM vs YUMMER in ', c),\n        fdr = 0.1, n_lfc = 20)\n})\n\n\n\n\n\n\n\n\n[1] \"No de genes\"\n\n\n\n\n\n\n\n\n\n\n\n[1] \"No de genes\"\n\n\n\n\n\n[[1]]\n\n[[2]]\n\n[[3]]\n[1] \"No de genes\"\n\n[[4]]\n\n[[5]]\n\n[[6]]\n\n[[7]]\n\n[[8]]\n[1] \"No de genes\""
  }
]